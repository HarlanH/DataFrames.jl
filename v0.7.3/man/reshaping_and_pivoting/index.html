<!DOCTYPE html><HTML class="no-js"><head><meta charset="utf-8"/><meta content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1" name="viewport"/><title>Reshaping · DataFrames.jl</title><link href="https://juliadata.github.io/DataFrames.jl/stable/man/reshaping_and_pivoting/index.html" rel="canonical"/><meta content="None" property="og:url"/><meta content="DataFrames.jl" property="og:title"/><meta content="None/../../" property="og:image"/><meta content="DataFrames.jl" name="apple-mobile-web-app-title"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/><link href="../../None" rel="shortcut icon" type="image/x-icon"/><link href="../../None" rel="icon" type="image/x-icon"/><style>
      @font-face {
      	font-family: 'Icon';
      	src: url('../../assets/fonts/icon.eot?52m981');
      	src: url('../../assets/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
      		   url('../../assets/fonts/icon.woff?52m981')
               format('woff'),
      		   url('../../assets/fonts/icon.ttf?52m981')
               format('truetype'),
      		   url('../../assets/fonts/icon.svg?52m981#icon')
               format('svg');
      	font-weight: normal;
      	font-style: normal;
      }
    </style><link href="../../assets/stylesheets/application-0dac3e5884.css" rel="stylesheet"/><link href="../../assets/stylesheets/palettes-05ab2406df.css" rel="stylesheet"/><link href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu+Mono" rel="stylesheet"/><style>
        body, input {
          font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
        }
        pre, code {
          font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
        }
      </style><link href="../../assets/Documenter.css" rel="stylesheet"/><script src="../../assets/javascripts/modernizr-4ab42b99fd.js"></script><script data-outdated-warner="">function maybeAddWarning () {
    const head = document.getElementsByTagName('head')[0];

    // Add a noindex meta tag (unless one exists) so that search engines don't index this version of the docs.
    if (document.body.querySelector('meta[name="robots"]') === null) {
        const meta = document.createElement('meta');
        meta.name = 'robots';
        meta.content = 'noindex';

        head.appendChild(meta);
    };

    // Add a stylesheet to avoid inline styling
    const style = document.createElement('style');
    style.type = 'text/css';
    style.appendChild(document.createTextNode('.outdated-warning-overlay {  position: fixed;  top: 0;  left: 0;  right: 0;  box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);  z-index: 999;  background-color: #ffaba7;  color: rgba(0, 0, 0, 0.7);  border-bottom: 3px solid #da0b00;  padding: 10px 35px;  text-align: center;  font-size: 15px; }  .outdated-warning-overlay .outdated-warning-closer {    position: absolute;    top: calc(50% - 10px);    right: 18px;    cursor: pointer;    width: 12px; }  .outdated-warning-overlay a {    color: #2e63b8; }    .outdated-warning-overlay a:hover {      color: #363636; }'));
    head.appendChild(style);

    const div = document.createElement('div');
    div.classList.add('outdated-warning-overlay');
    const closer = document.createElement('div');
    closer.classList.add('outdated-warning-closer');

    // Icon by font-awesome (license: https://fontawesome.com/license, link: https://fontawesome.com/icons/times?style=solid)
    closer.innerHTML = '<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="times" class="svg-inline--fa fa-times fa-w-11" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512"><path fill="currentColor" d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"></path></svg>';
    closer.addEventListener('click', function () {
        document.body.removeChild(div);
    });
    let href = '/stable';
    if (window.documenterBaseURL) {
        href = window.documenterBaseURL + '/../stable';
    }
    div.innerHTML = 'This is an old version of the documentation. <br> <a href="' + href + '">Go to the newest version</a>.';
    div.appendChild(closer);
    document.body.appendChild(div);
};

if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', maybeAddWarning);
} else {
    maybeAddWarning();
};
</script></head><body class="palette-primary-indigo palette-accent-blue"><div class="backdrop"><div class="backdrop-paper"></div></div><input class="toggle" id="toggle-drawer" type="checkbox"/><input class="toggle" id="toggle-search" type="checkbox"/><label class="toggle-button overlay" for="toggle-drawer"></label><header class="header"><nav aria-label="Header"><div class="bar default"><div aria-label="Menu" class="button button-menu" role="button"><label class="toggle-button icon icon-menu" for="toggle-drawer"><span></span></label></div><div class="stretch"><div class="title"><span class="path">
            
              
                User guide <i class="icon icon-link"></i></span>
        
        Reshaping
      </div></div><div aria-label="Search" class="button button-search" role="button"><label class="toggle-button icon icon-search" for="toggle-search" title="Search"></label></div></div><div class="bar search"><div aria-label="Close" class="button button-close" role="button"><label class="toggle-button icon icon-back" for="toggle-search"></label></div><div class="stretch"><div class="field"><input autocapitalize="off" autocomplete="off" autocorrect="off" class="query" placeholder="Search" spellcheck="" type="text"/></div></div><div aria-label="Search" class="button button-reset" role="button"><button class="toggle-button icon icon-close" id="reset-search"></button></div></div></nav></header><main class="main"><div class="drawer"><nav aria-label="Navigation"><a class="project" href="https://github.com/JuliaStats/DataFrames.jl"><div class="banner"><div class="name"><strong>
          DataFrames.jl
          <span class="version"></span></strong><br/>
          JuliaStats/DataFrames.jl
        
      </div></div></a><div class="scrollable"><div class="wrapper"><ul class="repo"><li class="repo-download"><a data-action="download" href="https://github.com/JuliaStats/DataFrames.jl/archive/master.zip" target="_blank" title="Download"><i class="icon icon-download"></i> Download
            </a></li><li class="repo-stars"><a data-action="star" href="https://github.com/JuliaStats/DataFrames.jl/stargazers" target="_blank" title="Stargazers"><i class="icon icon-star"></i> Stars
              <span class="count">–</span></a></li></ul><hr/><div class="toc"><ul><li><a class="" href="../.." title="Introduction">
      Introduction
    </a></li><li><span class="section">User guide</span><ul><li><a class="" href="../getting_started/" title="Getting Started">
      Getting Started
    </a></li><li><a class="" href="../io/" title="IO">
      IO
    </a></li><li><a class="" href="../joins/" title="Joins">
      Joins
    </a></li><li><a class="" href="../split_apply_combine/" title="Split-apply-combine">
      Split-apply-combine
    </a></li><li><a class="current" href="./" title="Reshaping">
      Reshaping
    </a></li><li><a class="" href="../sorting/" title="Sorting">
      Sorting
    </a></li><li><a class="" href="../formulas/" title="Formulas">
      Formulas
    </a></li><li><a class="" href="../pooling/" title="Pooling">
      Pooling
    </a></li></ul></li><li><span class="section">API</span><ul><li><a class="" href="../../lib/maintypes/" title="Main types">
      Main types
    </a></li><li><a class="" href="../../lib/utilities/" title="Utilities">
      Utilities
    </a></li><li><a class="" href="../../lib/manipulation/" title="Data manipulation">
      Data manipulation
    </a></li></ul></li><li><span class="section">About</span><ul><li><a class="" href="../../NEWS/" title="Release notes">
      Release notes
    </a></li><li><a class="" href="../../LICENSE/" title="License">
      License
    </a></li></ul></li></ul></div></div></div></nav></div><article class="article"><div class="wrapper"><p><a id="Reshaping-and-Pivoting-Data-1"></a></p><h1 id="reshaping-and-pivoting-data">Reshaping and Pivoting Data</h1><p>Reshape data from wide to long format using the <code>stack</code> function:</p><div class="codehilite"><pre><span></span><span class="k">using</span><span class="n">DataFrames</span><span class="p">,</span><span class="n">RDatasets</span><span class="n">iris</span><span class="o">=</span><span class="n">dataset</span><span class="p">(</span><span class="s">"datasets"</span><span class="p">,</span><span class="s">"iris"</span><span class="p">)</span><span class="n">iris</span><span class="p">[:</span><span class="n">id</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">iris</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="c"># this makes it easier to unstack</span><span class="n">d</span><span class="o">=</span><span class="n">stack</span><span class="p">(</span><span class="n">iris</span><span class="p">,</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">])</span></pre></div><p>The second optional argument to <code>stack</code> indicates the columns to be stacked. These are normally referred to as the measured variables. Column names can also be given:</p><div class="codehilite"><pre><span></span><span class="n">d</span><span class="o">=</span><span class="n">stack</span><span class="p">(</span><span class="n">iris</span><span class="p">,</span><span class="p">[:</span><span class="n">SepalLength</span><span class="p">,</span><span class="p">:</span><span class="n">SepalWidth</span><span class="p">,</span><span class="p">:</span><span class="n">PetalLength</span><span class="p">,</span><span class="p">:</span><span class="n">PetalWidth</span><span class="p">])</span></pre></div><p>Note that all columns can be of different types. Type promotion follows the rules of <code>vcat</code>.</p><p>The stacked DataFrame that results includes all of the columns not specified to be stacked. These are repeated for each stacked column. These are normally refered to as identifier (id) columns. In addition to the id columns, two additional columns labeled <code>:variable</code> and <code>:values</code> contain the column identifier and the stacked columns.</p><p>A third optional argument to <code>stack</code> represents the id columns that are repeated. This makes it easier to specify which variables you want included in the long format:</p><div class="codehilite"><pre><span></span><span class="n">d</span><span class="o">=</span><span class="n">stack</span><span class="p">(</span><span class="n">iris</span><span class="p">,</span><span class="p">[:</span><span class="n">SepalLength</span><span class="p">,</span><span class="p">:</span><span class="n">SepalWidth</span><span class="p">],</span><span class="p">:</span><span class="n">Species</span><span class="p">)</span></pre></div><p><code>melt</code> is an alternative function to reshape from wide to long format. It is based on <code>stack</code>, but it prefers specification of the id columns as:</p><div class="codehilite"><pre><span></span><span class="n">d</span><span class="o">=</span><span class="n">melt</span><span class="p">(</span><span class="n">iris</span><span class="p">,</span><span class="p">:</span><span class="n">Species</span><span class="p">)</span></pre></div><p>All other columns are assumed to be measured variables (they are stacked).</p><p>You can also stack an entire DataFrame. The default stacks all floating-point columns:</p><div class="codehilite"><pre><span></span><span class="n">d</span><span class="o">=</span><span class="n">stack</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span></pre></div><p><code>unstack</code> converts from a long format to a wide format. The default is requires specifying which columns are an id variable, column variable names, and column values:</p><div class="codehilite"><pre><span></span><span class="n">longdf</span><span class="o">=</span><span class="n">melt</span><span class="p">(</span><span class="n">iris</span><span class="p">,</span><span class="p">[:</span><span class="n">Species</span><span class="p">,</span><span class="p">:</span><span class="n">id</span><span class="p">])</span><span class="n">widedf</span><span class="o">=</span><span class="n">unstack</span><span class="p">(</span><span class="n">longdf</span><span class="p">,</span><span class="p">:</span><span class="n">id</span><span class="p">,</span><span class="p">:</span><span class="n">variable</span><span class="p">,</span><span class="p">:</span><span class="n">value</span><span class="p">)</span></pre></div><p>If the remaining columns are unique, you can skip the id variable and use:</p><div class="codehilite"><pre><span></span><span class="n">widedf</span><span class="o">=</span><span class="n">unstack</span><span class="p">(</span><span class="n">longdf</span><span class="p">,</span><span class="p">:</span><span class="n">variable</span><span class="p">,</span><span class="p">:</span><span class="n">value</span><span class="p">)</span></pre></div><p><code>stackdf</code> and <code>meltdf</code> are two additional functions that work like <code>stack</code> and <code>melt</code>, but they provide a view into the original wide DataFrame. Here is an example:</p><div class="codehilite"><pre><span></span><span class="n">d</span><span class="o">=</span><span class="n">stackdf</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span></pre></div><p>This saves memory. To create the view, several AbstractVectors are defined:</p><p><code>:variable</code> column – <code>EachRepeatedVector</code>   This repeats the variables N times where N is the number of rows of the original AbstractDataFrame.</p><p><code>:value</code> column – <code>StackedVector</code>   This is provides a view of the original columns stacked together.</p><p>Id columns – <code>RepeatedVector</code>   This repeats the original columns N times where N is the number of columns stacked.</p><p>For more details on the storage representation, see:</p><div class="codehilite"><pre><span></span><span class="n">dump</span><span class="p">(</span><span class="n">stackdf</span><span class="p">(</span><span class="n">iris</span><span class="p">))</span></pre></div><p>None of these reshaping functions perform any aggregation. To do aggregation, use the split-apply-combine functions in combination with reshaping. Here is an example:</p><div class="codehilite"><pre><span></span><span class="n">d</span><span class="o">=</span><span class="n">stack</span><span class="p">(</span><span class="n">iris</span><span class="p">)</span><span class="n">x</span><span class="o">=</span><span class="n">by</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="p">[:</span><span class="n">variable</span><span class="p">,</span><span class="p">:</span><span class="n">Species</span><span class="p">],</span><span class="n">df</span><span class="o">-&gt;</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">vsum</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">df</span><span class="p">[:</span><span class="n">value</span><span class="p">])))</span><span class="n">unstack</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="p">:</span><span class="n">Species</span><span class="p">,</span><span class="p">:</span><span class="n">vsum</span><span class="p">)</span></pre></div><aside class="copyright" role="note">
            
            Documentation built with
            <a href="http://www.mkdocs.org" target="_blank">MkDocs</a>
            using the
            <a href="http://squidfunk.github.io/mkdocs-material/" target="_blank">
              Material
            </a>
            theme.
          </aside><footer class="footer"><nav aria-label="Footer" class="pagination"><div class="previous"><a href="../split_apply_combine/" title="Split-apply-combine"><span class="direction">
            Previous
          </span><div class="page"><div aria-label="Previous" class="button button-previous" role="button"><i class="icon icon-back"></i></div><div class="stretch"><div class="title">
                Split-apply-combine
              </div></div></div></a></div><div class="next"><a href="../sorting/" title="Sorting"><span class="direction">
            Next
          </span><div class="page"><div class="stretch"><div class="title">
                Sorting
              </div></div><div aria-label="Next" class="button button-next" role="button"><i class="icon icon-forward"></i></div></div></a></div></nav></footer></div></article><div aria-live="polite" class="results" role="status"><div class="scrollable"><div class="wrapper"><div class="meta"></div><div class="list"></div></div></div></div></main><script>
      var base_url = '../..';
      var repo_id  = 'JuliaStats/DataFrames.jl';
    </script><script src="../../assets/javascripts/application-997097ee0c.js"></script><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script><script src="../../assets/mathjaxhelper.js"></script></body></HTML>